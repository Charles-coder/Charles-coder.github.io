---
title: 超级详尽的内存管理知识
date: 2023-09-17 10:39:41
tags: #后端开发 #面经
keywords: "JAVA，面经"
description: 操作系统中常考的内存管理

ai:
  - 本教程介绍了JAVA面试中常问的问题
---



## **进程运行的基本原理**

![image.png](https://cdn.nlark.com/yuque/0/2024/png/29788515/1714106029853-24ba097c-fd36-46a7-bb80-1bf54e9b6d7b.png?x-oss-process=image%2Fformat%2Cwebp)

#### 一、内存管理

##### 1.内存管理内容

###### （1）地址转换：

![image-20240505012323514](https://pic-1318156172.cos.ap-beijing.myqcloud.com/blog/image-20240505012323514.png)

编译：编译程序将用户源代码编译成若干个目标模块

链接：由链接程序将编译后形成的一组目标模块，以及所需要的库函数链接在一起，形成一个完整的装入模块。

装入：由装入程序将装入模块放进内存中运行

###### Point1：程序装入

绝对装入：在编译时如果知道程序将放入到内存中的哪个位置，编译程序将产生绝对地址的目标代码。装入程序按照装入模块中的地址，将程序的数据装入内存。

可重定位装入（静态重定位）：根据内存的目前情况将装入模块装入到内存的适当位置（装入时对地址进行重定位），地址变换是在装入时一次完成的。

动态运行时装入（动态重定位）：装入程序把装入模块装入内存后，并不会立即把逻辑地址转换为物理地址，而是把地址转换推迟到程序真正要执行时才进行（装入内存后所有的地址依然是逻辑地址），这种方式需要一个重定位寄存器的支持。（重定位模块存放可执行文件的起始位置）

优点：

1. 允许程序在内存中发生移动。
2. 可将程序分配到不连续的存储区中
3. 在程序运行前只需装入部分代码即可投入运行
4. 在程序运行期间，可根据需要动态申请分配内存空间
5. 可向用户提供一个比存储空间大得多的地址空间

###### Point2：程序链接

静态链接：在程序运行之前，先将各目标模块及所需的库函数连接成一个完整的可执行文件（装入模块），之后不再拆开。

![image-20240505014538995](https://pic-1318156172.cos.ap-beijing.myqcloud.com/blog/image-20240505014538995.png)

装入时动态链接：将各目标模块装入内存时，边装入边链接的方式。

![image-20240505014636186](https://pic-1318156172.cos.ap-beijing.myqcloud.com/blog/image-20240505014636186.png)

运行时动态链接：在程序执行中需要该目标模块时才对其进行链接，这种方式便于修改和更新，便于实现对目标模块的共享。

###### （2）内存保护：

上下限寄存器：在CPU中设置一对上下限寄存器，存放进程的上、下限地址。进程的指令要访问某个地址时，CPU检查是否越界。

![image-20240505014840894](https://pic-1318156172.cos.ap-beijing.myqcloud.com/blog/image-20240505014840894.png)

重定位寄存器：采用重定位寄存器（基地址寄存器）和界地址寄存器（限长寄存器）进行越界检查。重定位寄存器中存放的是进程的起始物理地址，界地址寄存器中存放的是进程的最大逻辑地址。

![image-20240505014901055](https://pic-1318156172.cos.ap-beijing.myqcloud.com/blog/image-20240505014901055.png)



###### （3）内存空间的扩充：

###### Point1：覆盖技术

覆盖技术：将程序分为多个段，常用段常驻内存不常用段在需要时调入内存，以解决程序大小超过物理内存总和的问题。

- 常用段：放在内存的固定区中，调入后就不再调出（除非运行结束）
- 非常用段：放在覆盖区，需要用到时调入内存，用不到时调出内存。

![image-20240505015035773](https://pic-1318156172.cos.ap-beijing.myqcloud.com/blog/image-20240505015035773.png)

###### Point2：交换技术

交换技术：内存空间紧张时，系统将内存中的某些进程暂时换出外存（进程的PCB保留在仍然内存中），把内存中某些已具备运行条件的进程换入内存（进程在内存与磁盘间动态调度）

![image-20240505015233010](https://pic-1318156172.cos.ap-beijing.myqcloud.com/blog/image-20240505015233010.png)

问题1：在外存的什么位置保存被换出的进程？

​	在具有交换功能的操作系统中，通常把磁盘分为文件区与对换区两部分。

​	文件区：主要用于存放文件，追求存储空间的利用率（采用离散分配方式）
​	对换区：主要用于存储被换出的进程，追求换入换出速度（采用连续分配方式）
问题2：什么时候进行进程交换？

​	交换通常在进程运行且内存吃紧的情况下发生，而当系统符合降低时就暂停。

​	例如：在发现许多进程运行时经常发生缺页，就说明内存紧张此时可以换出一些内存，而当缺页率下降时就可以暂停换出。

问题3：应该交换出哪些进程？

​	可优先换出阻塞的进程、优先换出优先级更低的进程、为了防止优先级低的进程饥饿，还会考虑进程在内存中驻留的时间问题。

【补充】覆盖与交换的区别

1. 覆盖是在同一个程序或进程中进行的
2. 交换是在不同的进程（或作业）之间进行的

###### （4）内存空间的分配与回收：

​	![image-20240505015829478](https://pic-1318156172.cos.ap-beijing.myqcloud.com/blog/image-20240505015829478.png)

###### （1）单一连续分配：（已淘汰非重点）

在单一连续分配方式中，内存被分为系统区与用户区

- 系统区：通常位于内存的低地址部分，用于存放操作系统相关数据。
- 用户区：用于存放用户进程相关数据。
- 内存中只能有一道用户程序，用户程序独占整个用户区空间。



###### （2）固定分区分配：（已淘汰非重点）

将整个用户空间划分为固定大小分区，每个分区中装入一道作业，为支持多道程序系统在内存中装入多道程序（且互不干扰）。

###### （3）动态分区分配：

不预先划分内存分区，而是在进程装入内存时根据进程的大小动态的建立分区，并使分区的大小正好适合进程的需要，因此系统分区的大小和数量是可变的。

问题1：操作系统用什么数据结构记录内存的使用情况？

答：空闲分区表、空闲分区链

